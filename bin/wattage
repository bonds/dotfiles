#!/usr/bin/env fish

argparse v/verbose -- $argv

# HOST=$(arp -a | grep -i "24:2F:D0:26:02:C9" | sed 's/\? (\(.*\)).*/\1/g')
# the outlet doesn't always respond to ARP so I'm just going to give it an
# IP reservation so it gets the same IP from DHCP every time

set WORKSTATION "10.0.0.75"
set SERVERRACK "10.0.0.189"

set hosts $WORKSTATION $SERVERRACK

for host in $hosts
    printf %12s "$host: "
    if not set -q _flag_verbose
        kasa --host $host emeter $argv | grep Power | awk '{printf "%.f\n", $2}'
    else
        kasa --host $host emeter $argv
    end
end
