#!/bin/sh

args=`getopt 'v' $*` || exit
set -- $args

while true; do
  case $1 in
  (-v) ((verbose++)); shift;;
  (--) shift; break;;
  (*)  exit 1;;
  esac
done

HOST=$(arp -a | grep -i "24:2F:D0:26:02:C9" | sed 's/\? (\(.*\)).*/\1/g')
if test -z "$verbose"; then
  kasa --host $HOST emeter | grep Power | awk '{printf "%.f\n", $2}'
else
  kasa --host $HOST emeter
fi
